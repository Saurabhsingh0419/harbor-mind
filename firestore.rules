// Firestore Security Rules for Harbor Mind App
// These rules allow anonymous users to read and write their own data

rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    
    // Chat Messages Collection
    // Users can only read/write their own messages
    match /chatMessages/{messageId} {
      allow read, write: if request.auth != null 
        && request.auth.uid == resource.data.userId;
      allow create: if request.auth != null 
        && request.auth.uid == request.resource.data.userId;
    }
    
    // Chat Sessions Collection  
    // Users can only read/write their own sessions
    match /chatSessions/{sessionId} {
      allow read, write: if request.auth != null 
        && request.auth.uid == resource.data.userId;
      allow create: if request.auth != null 
        && request.auth.uid == request.resource.data.userId;
    }
    
    // Deny all other access
    match /{document=**} {
      allow read, write: if false;
    }
  }
}

/*
SETUP INSTRUCTIONS:

1. Go to Firebase Console > Firestore Database > Rules
2. Replace the existing rules with the above content
3. Click "Publish" to deploy the rules

SECURITY NOTES:

- Anonymous users can only access their own data
- Each user is identified by their Firebase Auth UID
- Messages and sessions are tied to the authenticated user
- No cross-user data access is allowed
- All operations require authentication

TESTING THE RULES:

You can test these rules in the Firebase Console:
1. Go to Firestore Database > Rules
2. Click "Rules playground"
3. Test read/write operations for authenticated users
4. Verify that unauthenticated requests are denied
*/
